(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{1118:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return o(5971)}])},8189:function(e,t,o){"use strict";o.d(t,{H:function(){return u},a:function(){return i}});var r=o(5893),n=o(7294);let a=(0,n.createContext)(),i=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},l=()=>localStorage.getItem("token"),s=e=>{e?(localStorage.setItem("token",e),localStorage.setItem("loginTime",Date.now().toString())):(localStorage.removeItem("token"),localStorage.removeItem("loginTime"))},c=()=>{{let e=localStorage.getItem("loginTime");if(e)return Date.now()-parseInt(e)>108e5}return!0},u=e=>{var t,o,i;let{children:u}=e,[d,h]=(0,n.useState)(null),[f,g]=(0,n.useState)(null),[p,m]=(0,n.useState)(!0),[k,w]=(0,n.useState)(null),y=(null===(t=window.localStorage)||void 0===t?void 0:t.getItem("token"))==="mock-jwt-token-for-screenshots"||(null===(i=window.location)||void 0===i?void 0:null===(o=i.search)||void 0===o?void 0:o.includes("screenshot=true"));(0,n.useEffect)(()=>{if(k&&!y){let e=setInterval(()=>{c()&&(console.log("AuthContext: Token expired, auto-logging out"),v())},3e5);return()=>clearInterval(e)}},[k,y]),(0,n.useEffect)(()=>{(async()=>{if(y){h({id:"test-user-123",email:"test@example.com",username:"testuser"}),g({bio:"Test user for screenshot validation",category:"Developer",experience_level:"Intermediate",location:"San Francisco, CA"}),w("mock-jwt-token-for-screenshots"),m(!1);return}let e=l();if(e&&!c()){console.log("AuthContext: Restoring session with stored token"),w(e);try{let t=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:"Token ".concat(e)},credentials:"include"});if(t.ok){let e=await t.json(),o={id:e.user_email,email:e.user_email,username:e.user_email.split("@")[0]};h(o),g(e)}else s(null),w(null)}catch(e){console.error("AuthContext: Failed to load profile:",e),s(null),w(null)}}else e&&c()&&(console.log("AuthContext: Token expired, clearing"),s(null));m(!1)})()},[]);let x=async()=>{try{console.log("AuthContext: Making profile API call with token:",k);let e=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:"Token ".concat(k)},credentials:"include"});if(console.log("AuthContext: Profile API response status:",e.status),e.ok){let t=await e.json();console.log("AuthContext: Profile data received:",t);let o={id:t.user_email,email:t.user_email,username:t.user_email.split("@")[0]};console.log("AuthContext: Setting user:",o),console.log("AuthContext: Setting profile:",t),h(o),g(t)}else console.log("AuthContext: Invalid token, logging out"),v()}catch(e){console.error("Failed to load user profile:",e),v()}finally{console.log("AuthContext: Setting loading to false"),m(!1)}},S=async(e,t)=>{try{m(!0);let o=await fetch("http://127.0.0.1:8000/api/auth/login/",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(!o.ok)throw Error("Login failed");let r=await o.json();if(console.log("AuthContext: Login response data:",r),w(r.token),h(r.user),s(r.token),r.token){console.log("AuthContext: Login successful, loading profile immediately");try{let e=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:"Token ".concat(r.token)},credentials:"include"});if(e.ok){let t=await e.json();console.log("AuthContext: Profile loaded immediately after login:",t),g(t)}}catch(e){console.error("AuthContext: Failed to load profile after login:",e)}}return m(!1),{success:!0}}catch(e){return m(!1),{success:!1,error:"Network error occurred"}}},C=async(e,t,o,r)=>{try{m(!0);let n=await fetch("http://127.0.0.1:8000/api/auth/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:t,password:o,password_confirm:r})});if(!n.ok)throw Error("Registration failed");let a=await n.json();w(a.token),h(a.user),s(a.token)}catch(e){throw e}finally{m(!1)}},v=()=>{console.log("AuthContext: Logging out user"),s(null),w(null),h(null),g(null),localStorage.removeItem("token"),localStorage.removeItem("loginTime")},A=async e=>{try{let t=new FormData;Object.keys(e).forEach(o=>{null!==e[o]&&void 0!==e[o]&&("avatar"===o&&e[o]instanceof File?t.append(o,e[o]):"object"==typeof e[o]?t.append(o,JSON.stringify(e[o])):t.append(o,e[o]))});let o=await fetch("http://127.0.0.1:8000/api/auth/profile/",{method:"PATCH",headers:{Authorization:"Token ".concat(k)},body:t});if(o.ok){let e=await o.json();return g(e.profile),{success:!0}}{let e=await o.json();return{success:!1,error:e.message||"Profile update failed"}}}catch(e){return{success:!1,error:"Network error occurred"}}};return(0,r.jsx)(a.Provider,{value:{user:d,profile:f,loading:p,login:S,register:C,logout:v,updateProfile:A,refreshProfile:x},children:u})}},2187:function(e,t,o){"use strict";o.d(t,{m:function(){return l},q:function(){return s}});var r=o(5893),n=o(7294),a=o(8189);let i=(0,n.createContext)(),l=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e},s=e=>{let{children:t}=e,{user:o}=(0,a.a)(),[l,s]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{o?f():h(!1)},[o]);let f=async()=>{try{await Promise.all([g(),p()])}catch(e){console.error("Failed to load subscription data:",e)}finally{h(!1)}},g=async()=>{try{let e=localStorage.getItem("token");if(!e)return;let t=await fetch("http://127.0.0.1:8000/api/auth/subscription/current/",{headers:{Authorization:"Token ".concat(e)}});if(t.ok){let e=await t.json();s(e.subscription)}}catch(e){console.error("Failed to load subscription:",e)}},p=async()=>{try{let e=localStorage.getItem("token");if(!e)return;let t=await fetch("http://127.0.0.1:8000/api/auth/subscription/usage-limits/",{headers:{Authorization:"Token ".concat(e)}});if(t.ok){let e=await t.json();u(e.usage_limits)}}catch(e){console.error("Failed to load usage:",e)}},m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{let o=localStorage.getItem("token");if(!o)return!1;if((await fetch("http://127.0.0.1:8000/api/auth/subscription/usage/increment/",{method:"POST",headers:{Authorization:"Token ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({feature_type:e,amount:t})})).ok)return await p(),!0}catch(e){console.error("Failed to increment usage:",e)}return!1};return(0,r.jsx)(i.Provider,{value:{subscription:l,usage:c,loading:d,checkUsageLimit:e=>{if(!c||!c[e])return{canUse:!0,limit:0,used:0};let t=c[e];return{canUse:!t.is_exceeded,limit:t.limit,used:t.current_usage,percentage:t.usage_percentage}},incrementUsage:m,refreshSubscription:f},children:t})}},5971:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return s}});var r=o(5893),n=o(8189),a=o(2187),i=o(7294);class l extends i.Component{static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("\uD83D\uDEA8 ErrorBoundary caught error:",e),console.error("\uD83D\uDD0D Error info:",t),console.error("\uD83D\uDCCD Component stack:",t.componentStack),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,r.jsxs)("div",{style:{padding:"2rem",border:"2px solid #dc3545",borderRadius:"8px",backgroundColor:"#f8d7da",color:"#721c24",margin:"1rem"},children:[(0,r.jsx)("h2",{children:"\uD83D\uDEA8 React Error Caught"}),(0,r.jsxs)("details",{style:{whiteSpace:"pre-wrap"},children:[(0,r.jsx)("summary",{children:"Error Details"}),(0,r.jsx)("strong",{children:"Error:"})," ",this.state.error&&this.state.error.toString(),(0,r.jsx)("br",{}),(0,r.jsx)("strong",{children:"Component Stack:"}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),style:{marginTop:"1rem",padding:"0.5rem 1rem",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px"},children:"Reload Page"})]}):this.props.children}constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}}function s(e){let{Component:t,pageProps:o}=e;return(0,r.jsx)(l,{children:(0,r.jsx)(n.H,{children:(0,r.jsx)(a.q,{children:(0,r.jsx)(t,{...o})})})})}}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],function(){return t(1118),t(3035)}),_N_E=e.O()}]);