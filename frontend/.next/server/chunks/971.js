"use strict";exports.id=971,exports.ids=[971],exports.modules={8189:(e,t,r)=>{r.d(t,{H:()=>c,a:()=>a});var o=r(997),n=r(6689);let l=(0,n.createContext)(),a=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e},s=()=>null,i=e=>{},u=()=>!0,c=({children:e})=>{let[t,r]=(0,n.useState)(null),[a,c]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0),[p,f]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(p){let e=setInterval(()=>{u()&&(console.log("AuthContext: Token expired, auto-logging out"),y())},3e5);return()=>clearInterval(e)}},[p,!1]),(0,n.useEffect)(()=>{(async()=>{let e=s();if(e&&!u()){console.log("AuthContext: Restoring session with stored token"),f(e);try{let t=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:`Token ${e}`},credentials:"include"});if(t.ok){let e=await t.json(),o={id:e.user_email,email:e.user_email,username:e.user_email.split("@")[0]};r(o),c(e)}else i(null),f(null)}catch(e){console.error("AuthContext: Failed to load profile:",e),i(null),f(null)}}else e&&u()&&(console.log("AuthContext: Token expired, clearing"),i(null));h(!1)})()},[]);let g=async()=>{try{console.log("AuthContext: Making profile API call with token:",p);let e=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:`Token ${p}`},credentials:"include"});if(console.log("AuthContext: Profile API response status:",e.status),e.ok){let t=await e.json();console.log("AuthContext: Profile data received:",t);let o={id:t.user_email,email:t.user_email,username:t.user_email.split("@")[0]};console.log("AuthContext: Setting user:",o),console.log("AuthContext: Setting profile:",t),r(o),c(t)}else console.log("AuthContext: Invalid token, logging out"),y()}catch(e){console.error("Failed to load user profile:",e),y()}finally{console.log("AuthContext: Setting loading to false"),h(!1)}},m=async(e,t)=>{try{h(!0);let o=await fetch("http://127.0.0.1:8000/api/auth/login/",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:t})});if(!o.ok)throw Error("Login failed");let n=await o.json();if(console.log("AuthContext: Login response data:",n),f(n.token),r(n.user),i(n.token),n.token){console.log("AuthContext: Login successful, loading profile immediately");try{let e=await fetch("http://127.0.0.1:8000/api/auth/profile/",{headers:{Authorization:`Token ${n.token}`},credentials:"include"});if(e.ok){let t=await e.json();console.log("AuthContext: Profile loaded immediately after login:",t),c(t)}}catch(e){console.error("AuthContext: Failed to load profile after login:",e)}}return h(!1),{success:!0}}catch(e){return h(!1),{success:!1,error:"Network error occurred"}}},x=async(e,t,o,n)=>{try{h(!0);let l=await fetch("http://127.0.0.1:8000/api/auth/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,username:t,password:o,password_confirm:n})});if(!l.ok)throw Error("Registration failed");let a=await l.json();f(a.token),r(a.user),i(a.token)}catch(e){throw e}finally{h(!1)}},y=()=>{console.log("AuthContext: Logging out user"),i(null),f(null),r(null),c(null)},k=async e=>{try{let t=new FormData;Object.keys(e).forEach(r=>{null!==e[r]&&void 0!==e[r]&&("avatar"===r&&e[r]instanceof File?t.append(r,e[r]):"object"==typeof e[r]?t.append(r,JSON.stringify(e[r])):t.append(r,e[r]))});let r=await fetch("http://127.0.0.1:8000/api/auth/profile/",{method:"PATCH",headers:{Authorization:`Token ${p}`},body:t});if(r.ok){let e=await r.json();return c(e.profile),{success:!0}}{let e=await r.json();return{success:!1,error:e.message||"Profile update failed"}}}catch(e){return{success:!1,error:"Network error occurred"}}};return o.jsx(l.Provider,{value:{user:t,profile:a,loading:d,login:m,register:x,logout:y,updateProfile:k,refreshProfile:g},children:e})}},2187:(e,t,r)=>{r.d(t,{m:()=>s,q:()=>i});var o=r(997),n=r(6689),l=r(8189);let a=(0,n.createContext)(),s=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useSubscription must be used within a SubscriptionProvider");return e},i=({children:e})=>{let{user:t}=(0,l.a)(),[r,s]=(0,n.useState)(null),[i,u]=(0,n.useState)(null),[c,d]=(0,n.useState)(!0);(0,n.useEffect)(()=>{t?h():d(!1)},[t]);let h=async()=>{try{await Promise.all([p(),f()])}catch(e){console.error("Failed to load subscription data:",e)}finally{d(!1)}},p=async()=>{try{return}catch(e){console.error("Failed to load subscription:",e)}},f=async()=>{try{return}catch(e){console.error("Failed to load usage:",e)}},g=async(e,t=1)=>!1;return o.jsx(a.Provider,{value:{subscription:r,usage:i,loading:c,checkUsageLimit:e=>{if(!i||!i[e])return{canUse:!0,limit:0,used:0};let t=i[e];return{canUse:!t.is_exceeded,limit:t.limit,used:t.current_usage,percentage:t.usage_percentage}},incrementUsage:g,refreshSubscription:h},children:e})}},5971:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var o=r(997),n=r(8189),l=r(2187),a=r(6689),s=r.n(a);class i extends s().Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("\uD83D\uDEA8 ErrorBoundary caught error:",e),console.error("\uD83D\uDD0D Error info:",t),console.error("\uD83D\uDCCD Component stack:",t.componentStack),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,o.jsxs)("div",{style:{padding:"2rem",border:"2px solid #dc3545",borderRadius:"8px",backgroundColor:"#f8d7da",color:"#721c24",margin:"1rem"},children:[o.jsx("h2",{children:"\uD83D\uDEA8 React Error Caught"}),(0,o.jsxs)("details",{style:{whiteSpace:"pre-wrap"},children:[o.jsx("summary",{children:"Error Details"}),o.jsx("strong",{children:"Error:"})," ",this.state.error&&this.state.error.toString(),o.jsx("br",{}),o.jsx("strong",{children:"Component Stack:"}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),o.jsx("button",{onClick:()=>window.location.reload(),style:{marginTop:"1rem",padding:"0.5rem 1rem",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px"},children:"Reload Page"})]}):this.props.children}}function u({Component:e,pageProps:t}){return o.jsx(i,{children:o.jsx(n.H,{children:o.jsx(l.q,{children:o.jsx(e,{...t})})})})}}};